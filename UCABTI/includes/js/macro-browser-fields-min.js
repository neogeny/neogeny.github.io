AJS.MacroBrowser.Field=function(D,B,C){C=C||{};var E=C.setValue||function(F){B.val(F)};var A=C.getValue||function(){return B.val()};B.change(C.onchange||AJS.MacroBrowser.paramChanged);return{paramDiv:D,input:B,setValue:E,getValue:A}};AJS.MacroBrowser.ParameterFields=(function(E){var F=function(H){return{selectionHandler:function(J,I){H(I);this.hide();J.preventDefault()}}};var D=function(I){E("ol.last",I).remove();if(E("ol",I).length==0){var H=AJS.clone("#macro-param-smartfield-no-suggestion-template");I.append(H.find("ol"))}};var B=function(H){return function(J){var I=AJS("div");I.addClass("macro-param-dropdown-wrapper aui-dd-parent");I.append(J);H.after(I)}};var A=function(H,I){H.keyup(function(K){if(K.keyCode==27){var J=H.parent();if(!J){return }if(E(".aui-dropdown:not(.hidden)",J).length){I.hide();return AJS.stopEvent(K)}return }})};var C=function(I,P,R,Q,M,J){R=R||{};var N=AJS.clone("#macro-param-hidden-text-template");var H=AJS.$("input[type='text']",N);var O=AJS.$("input[type='hidden']",N);var K=makeItemList(I,O,H,R.onchange);var L=function(U){var T=E("span",U);var S=AJS.$.data(T[0],"properties");var V=M(S);addItemToList(K,V.value,V.display);H.focus()};H.quicksearch("/json/contentnamesearch.action?"+Q(),function(S){E("ol.last",S).remove();E("a",S).click(function(T){T.preventDefault();(R.onselect||L)(T.target)})});if(P){(R.setValue||J)(P,K)}return AJS.MacroBrowser.Field(N,O)};var G=function(L,K,J){if(K&&K.length){for(var H=0,I=K.length;H<I;H++){AJS.MacroBrowser.fields[K[H]].dependencyUpdated(L,J)}}};return{updateDependencies:G,username:function(L,I){if(L.multiple){return AJS.MacroBrowser.ParameterFields.string(L,I)}I=I||{};I.queryParams=I.queryParams||function(){return"/json/contentnamesearch.action?type=userinfo"};var K=AJS.clone("#macro-param-template");var H=AJS.$("input[type='text']",K);if(L.required){H.keyup(AJS.MacroBrowser.processRequiredParameters)}I.setValue=I.setValue||function(M){H.val(M);G(L.name,I.dependencies,H.val());(typeof I.onchange=="function")&&I.onchange.apply(H)};var J=I.onselect||function(O){if(!O.hasClass("message")){var N=E("span",O);var M=E.data(N[0],"properties");var P=M.href.substr(M.href.lastIndexOf("/")+2);I.setValue(unescape(P))}};H.quicksearch(I.queryParams(),null,{dropdownPostprocess:D,dropdownPlacement:B(H),ajsDropDownOptions:F(J)});return AJS.MacroBrowser.Field(K,H)},spacekey:function(L,I){if(L.multiple){return AJS.MacroBrowser.ParameterFields.string(L,I)}I=I||{};I.queryParams=I.queryParams||function(){return"/json/contentnamesearch.action?type=spacedesc&type=personalspacedesc"};var K=AJS.clone("#macro-param-template");var H=AJS.$("input[type='text']",K);if(L.required){H.keyup(AJS.MacroBrowser.processRequiredParameters)}I.setValue=I.setValue||function(M){H.val(M);G(L.name,I.dependencies,H.val());(typeof I.onchange=="function")&&I.onchange.apply(H)};var J=I.onselect||function(O){if(!O.hasClass("message")){var N=E("span",O);var M=E.data(N[0],"properties");I.setValue(M.spaceKey)}};H.quicksearch(I.queryParams(),null,{dropdownPostprocess:D,dropdownPlacement:B(H),ajsDropDownOptions:F(J)});return AJS.MacroBrowser.Field(K,H)},attachment:function(L,I){if(L.multiple){return AJS.MacroBrowser.ParameterFields.string(L,I)}var J=AJS.clone("#macro-param-select-template");var H=AJS.$("select",J);I=I||{};I.setValue=I.setValue||function(O){var M=false;H.find("option").filter("[value="+O+"]").each(function(){M=true});if(!M){H.append(AJS.$("<option/>").attr("value",O).html(O+" ("+AJS.params.notFound+")"));H.tempValue=O}else{delete H.tempValue}try{H.val(O)}catch(N){AJS.log(N)}H.change()};var K=AJS.MacroBrowser.Field(J,H,I);K.updateDependencies=G;K.getData=function(O){if(!((O.title&&O.spaceKey)||O.pageId||O.draftId)){AJS.log("Not enough parameters to send attachmentsearch request");return }var N=H.tempValue||H.val();if(I.fileTypes){O.fileTypes=I.fileTypes}var M=AJS.params.contextPath+(O.draftId?"/json/draftattachmentsearch.action":"/json/attachmentsearch.action");E.getJSON(M,O,function(S){if(S.error){return }E("option",H).remove();var P=S.attachments;if(!P.length){H.append(AJS.$("<option/>").attr("value","").html(AJS.params.noAppropriateAttachments));if(H.tempValue){I.setValue(H.tempValue)}}else{for(var Q=0,R=P.length;Q<R;Q++){H.append(AJS.$("<option/>").attr("value",P[Q].fileName).html(P[Q].fileName))}N=N||H.tempValue;I.setValue(N||P[0].fileName)}})};return K},"confluence-content":function(N,J){if(N.multiple){return AJS.MacroBrowser.ParameterFields.string(N,J)}J=J||{};N.options=N.options||{};J.queryParams=function(){var S=(N.options.type||"page,blogpost").split(",");for(var R=0,Q=S.length;R<Q;R++){S[R]="type="+S[R]}var P=S.join("&");var O="";if(N.options.spaceKey){if(N.options.spaceKey.toLowerCase()=="@self"){N.options.spaceKey=AJS.params.spaceKey}O="&spaceKey="+N.options.spaceKey}return"/json/contentnamesearch.action?"+P+O};var M=function(O){var S=O.spaceKey;var R=O.name;var P=O.href;if(O.className=="content-type-blogpost"){var U=P.substr(AJS.params.contextPath.length+1);var Q=U.indexOf("/"+S+"/");if(Q>-1){var T=Q+S.length+1;R=U.substring(T)}else{}}R=R.replace(/\+/g," ");return((S&&S!=AJS.params.spaceKey)?(S+":"):"")+R};var L=AJS.clone("#macro-param-template");var I=AJS.$("input[type='text']",L);if(N.required){I.keyup(AJS.MacroBrowser.processRequiredParameters)}J.setValue=J.setValue||function(O){I.val(O);(typeof J.onchange=="function")&&J.onchange.apply(I)};var K=J.onselect||function(R){if(!R.hasClass("message")){var Q=E("span",R);var P=E.data(Q[0],"properties");var O=M(P);J.setValue(O,I)}};J.onchange=J.onchange||function(O){var P=I.val();G(N.name,J.dependencies,P)};var H=function(P){E("ol.last",P).remove();if(E("ol",P).length==0){var O=AJS.clone("#macro-param-smartfield-no-suggestion-template");P.append(O.find("ol"))}else{E("a",P).each(function(){var R=E(this);var Q=R.find("span");R.attr("title","("+AJS.dropDown.getAdditionalPropertyValue(Q,"spaceName")+") "+Q.text())})}};I.quicksearch(J.queryParams(),null,{dropdownPostprocess:H,dropdownPlacement:B(I),ajsDropDownOptions:F(K)});return AJS.MacroBrowser.Field(L,I,J)},string:function(K,I){var J=AJS.clone("#macro-param-template");var H=E("input",J);if(K.required){H.keyup(AJS.MacroBrowser.processRequiredParameters)}return AJS.MacroBrowser.Field(J,H,I)},"boolean":function(K,I){var J=AJS.clone("#macro-param-checkbox-template");var H=E("input",J);I=I||{};I.setValue=I.setValue||function(L){if(/true/i.test(L)||(/true/i.test(K.defaultValue)&&!(/false/i).test(L))){H.attr("checked","checked")}};return AJS.MacroBrowser.Field(J,H,I)},"enum":function(K,I){if(K.multiple){return AJS.MacroBrowser.ParameterFields.string(K,I)}var J=AJS.clone("#macro-param-select-template");var H=E("select",J);if(!(K.required||K.defaultValue)){H.append(AJS.$("<option/>").attr("value",""))}E(K.enumValues).each(function(){H.append(AJS.$("<option/>").attr("value",this).html(""+this))});return AJS.MacroBrowser.Field(J,H,I)},_hidden:function(K,I){var J=AJS.clone("#macro-param-hidden-template").hide();var H=E("input",J);return AJS.MacroBrowser.Field(J,H,I)}}})(AJS.$);