jQuery.fn.movePageBrowse=function(M,J,B,L,D,F){var E=jQuery;var C=E("#confluence-context-path").attr("content");var A=this;var G=E(".tree",A);G.addClass("loading").html(AJS.renderTemplate("movePagePanelLoading"));var O,K=function(){G.removeClass("rendering").addClass("expanding");E("#parent-selection-tree .dialog-button-panel").remove();H(AJS.params.spaceKey,D,function(R){if(R&&D!=""){var P=O.findNodeBy("text",D);if(P){P.$.find("> a").addClass("current-parent")}}if(R&&AJS.params.pageTitle!=""){var Q=O.findNodeBy("text",AJS.params.pageTitle);if(Q){Q.makeUnclickable();if(AJS.params.pageTitle!=F){Q.setText(F)}}}H(J,L,function(V){if(V){var U=O.findNodeBy("text",L);if(U){U.$.find("> a").addClass("highlighted");var S=U.$.position().top;var T=G.height();if(S<0||S>T){G.scrollTop(G.scrollTop()+S-T/3)}}}G.removeClass("expanding")})})};var I=function(P){P.preventDefault();E("a.highlighted",G).removeClass("highlighted");E(this).addClass("highlighted");J=E("#chosenSpaceKey").val();B=E("#chosenSpaceKey option:selected").text();L=E(this).hasClass("root-node")?"":E(this).find("span").text();M.select(J,B,L)};var N=function(){E("select#chosenSpaceKey").val(J).change(function(){var Q=E(this).val();var P=E(this).find("option:selected").text();E("#tree-root-node-item a").text(P).toggleClass("highlighted",J==Q&&L=="").toggleClass("current-parent",AJS.params.spaceKey==Q&&D=="");G.addClass("rendering");O=O.reload({initUrl:C+"/pages/children.action?spaceKey="+encodeURIComponent(Q)+"&node=root"})});E("#tree-root-div").html(AJS.renderTemplate("movePageBrowsePanelSpace",B)).find("a").click(I).toggleClass("highlighted",L=="").toggleClass("current-parent",AJS.params.spaceKey==J&&D=="")};var H=function(Q,P,R){if(Q!=E("#chosenSpaceKey").val()){R(false);return }console.log("before breadcrumbs");AJS.MoveDialog.getBreadcrumbs({spaceKey:Q,title:P},function(S){var T=E.map(S.slice(1),function(U){return{text:U.title}});console.log("before expandPath");O.expandPath(T,function(){console.log("expandPath callback");R(true)})},function(){M.error("Could not retrieve tree expansion information.");R(false)})};G.load(C+"/panels/browsepagelocation.action",{panelName:"browse",dialogMode:"view",spaceKey:J,parentPageString:L,pageId:AJS.params.pageId},function(){G.removeClass("loading").addClass("rendering");N();O=E("#parent-selection-tree").tree({url:C+"/pages/children.action",initUrl:C+"/pages/children.action?spaceKey="+encodeURIComponent(J)+"&node=root",parameters:["pageId","text"],undraggable:true,spinnerId:"move-page-dialog-spinner",nodeId:"pageId",click:I,onready:K,oninsert:function(){var P=this.$;if(P.parents("li:first").attr("unclickable")){this.makeUnclickable()}}});AJS.MoveDialog.tree=O})};