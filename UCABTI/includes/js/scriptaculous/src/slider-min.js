if(!Control){var Control={}}Control.Slider=Class.create();Control.Slider.prototype={initialize:function(D,A,B){this.handle=$(D);this.track=$(A);this.options=B||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step)||1;this.value=0;var C=Math.round(this.track.offsetWidth/this.increment);if(this.isVertical()){C=Math.round(this.track.offsetHeight/this.increment)}this.maximum=this.options.maximum||C;this.minimum=this.options.minimum||0;this.alignX=parseInt(this.options.alignX)||0;this.alignY=parseInt(this.options.alignY)||0;this.setCurrentLeft(Position.cumulativeOffset(this.track)[0]-Position.cumulativeOffset(this.handle)[0]+this.alignX);this.setCurrentTop(this.trackTop()-Position.cumulativeOffset(this.handle)[1]+this.alignY);this.offsetX=0;this.offsetY=0;this.originalLeft=this.currentLeft();this.originalTop=this.currentTop();this.originalZ=parseInt(this.handle.style.zIndex||"0");this.setSliderValue(parseInt(this.options.sliderValue)||0);this.active=false;this.dragging=false;this.disabled=false;this.handleImage=$(this.options.handleImage)||false;this.handleDisabled=this.options.handleDisabled||false;this.handleEnabled=false;if(this.handleImage){this.handleEnabled=this.handleImage.src||false}if(this.options.disabled){this.setDisabled()}this.values=this.options.values||false;Element.makePositioned(this.handle);this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress)},dispose:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress)},setDisabled:function(){this.disabled=true;if(this.handleDisabled){this.handleImage.src=this.handleDisabled}},setEnabled:function(){this.disabled=false;if(this.handleEnabled){this.handleImage.src=this.handleEnabled}},currentLeft:function(){return parseInt(this.handle.style.left||"0")},currentTop:function(){return parseInt(this.handle.style.top||"0")},setCurrentLeft:function(A){this.handle.style.left=A+"px"},setCurrentTop:function(A){this.handle.style.top=A+"px"},trackLeft:function(){return Position.cumulativeOffset(this.track)[0]},trackTop:function(){return Position.cumulativeOffset(this.track)[1]},getNearestValue:function(C){if(this.values){var A=0;var E=Math.abs(this.values[0]-C);var D=this.values[0];for(A=0;A<this.values.length;A++){var B=Math.abs(this.values[A]-C);if(B<E){D=this.values[A];E=B}}return D}return C},setSliderValue:function(B){B=this.getNearestValue(B);if(B>this.maximum){B=this.maximum}if(B<this.minimum){B=this.minimum}var A=(B-(this.value||this.minimum))*this.increment;if(this.isVertical()){this.setCurrentTop(A+this.currentTop())}else{this.setCurrentLeft(A+this.currentLeft())}this.value=B;this.updateFinished()},minimumOffset:function(){return(this.isVertical()?this.trackTop()+this.alignY:this.trackLeft()+this.alignX)},maximumOffset:function(){return(this.isVertical()?this.trackTop()+this.alignY+(this.maximum-this.minimum)*this.increment:this.trackLeft()+this.alignX+(this.maximum-this.minimum)*this.increment)},isVertical:function(){return(this.axis=="vertical")},startDrag:function(B){if(Event.isLeftClick(B)){if(!this.disabled){this.active=true;var C=[Event.pointerX(B),Event.pointerY(B)];var A=Position.cumulativeOffset(this.handle);this.offsetX=(C[0]-A[0]);this.offsetY=(C[1]-A[1]);this.originalLeft=this.currentLeft();this.originalTop=this.currentTop()}Event.stop(B)}},update:function(B){if(this.active){if(!this.dragging){var A=this.handle.style;this.dragging=true;if(A.position==""){A.position="relative"}A.zIndex=this.options.zindex}this.draw(B);if(navigator.appVersion.indexOf("AppleWebKit")>0){window.scrollBy(0,0)}Event.stop(B)}},draw:function(C){var D=[Event.pointerX(C),Event.pointerY(C)];var B=Position.cumulativeOffset(this.handle);B[0]-=this.currentLeft();B[1]-=this.currentTop();D[0]-=this.offsetX;D[1]-=this.offsetY;var A=this.handle.style;if(this.isVertical()){if(D[1]>this.maximumOffset()){D[1]=this.maximumOffset()}if(D[1]<this.minimumOffset()){D[1]=this.minimumOffset()}if(this.values){this.value=this.getNearestValue(Math.round((D[1]-this.minimumOffset())/this.increment)+this.minimum);D[1]=this.trackTop()+this.alignY+(this.value-this.minimum)*this.increment}else{this.value=Math.round((D[1]-this.minimumOffset())/this.increment)+this.minimum}A.top=D[1]-B[1]+"px"}else{if(D[0]>this.maximumOffset()){D[0]=this.maximumOffset()}if(D[0]<this.minimumOffset()){D[0]=this.minimumOffset()}if(this.values){this.value=this.getNearestValue(Math.round((D[0]-this.minimumOffset())/this.increment)+this.minimum);D[0]=this.trackLeft()+this.alignX+(this.value-this.minimum)*this.increment}else{this.value=Math.round((D[0]-this.minimumOffset())/this.increment)+this.minimum}A.left=(D[0]-B[0])+"px"}if(this.options.onSlide){this.options.onSlide(this.value)}},endDrag:function(A){if(this.active&&this.dragging){this.finishDrag(A,true);Event.stop(A)}this.active=false;this.dragging=false},finishDrag:function(A,B){this.active=false;this.dragging=false;this.handle.style.zIndex=this.originalZ;this.originalLeft=this.currentLeft();this.originalTop=this.currentTop();this.updateFinished()},updateFinished:function(){if(this.options.onChange){this.options.onChange(this.value)}},keyPress:function(A){if(this.active&&!this.disabled){switch(A.keyCode){case Event.KEY_ESC:this.finishDrag(A,false);Event.stop(A);break}if(navigator.appVersion.indexOf("AppleWebKit")>0){Event.stop(A)}}}};