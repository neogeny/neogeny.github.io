(function(D){var B=function(F){var E=D(".aui-tip-parent");E=AJS.$('<div class="aui-tip-parent"></div>');var H=-11;if(AJS.$.browser.msie){H=(parseInt(AJS.$.browser.version,10)<8)?-5:-13}E.css({top:H,left:10});F.prepend(E).css({zIndex:3001});var G=Raphael(E[0],12,6);G.path("M0.001,6.001l6.001-6.001,6.001,6.001").attr({fill:"#f0f0f0",stroke:"#e2e2e2"});G.canvas.style.zIndex=3000;tip=G;return G};var C=function(E){var F=D(".aui-shadow-parent");F=AJS.$('<div class="aui-shadow-parent"></div>').css({top:E.css("top"),left:E.position().left-1,width:E.width(),height:E.height(),position:"absolute",zIndex:2000}).insertBefore(E);if(AJS.$.browser.msie){F.css({right:-5})}Raphael.shadow(0,0,E.outerWidth(true),E.outerHeight(true),{r:0.2,shadow:"#333",size:0.3,stroke:"none",color:"none",target:F[0]});return F};var A=function(F,E){E=E||{};setTimeout(function(){var I=AJS.Editor.Adapter.offset(F.anchor),O=F.panel.width()+I.left-D(window).width()+10,R=7,G=0,J=D(F.anchor).outerHeight(),N=I.top+J+R,H=I.left-(O>0?O:0)-G;if(F.options.anchorIframe){var Q=D(F.options.anchorIframe);var M=Q.offset().top+Q.height();N=Math.min(N,M)}F.panel.find(".aui-tip-parent").css({left:Math.abs(I.left-H)+10});var L={top:N,left:H};var P=F.panel.add(F.shadow),K=function(){F.shadow.css("left",F.panel.position().left-1)};E.animate?P.animate(L,E.animateDuration,K):(function(){P.css(L);K()})()},E.delay||0)};AJS.Confluence.PropertyPanel={current:null,createFromButtonModel:function(F,K,N){var E=AJS("div").attr({"class":"panel-buttons"});for(var H=0,M=K.length;H<M;H++){if(!K[H]){continue}var I=K[H],J=I.html||'<span class="icon"></span><span class="panel-button-text">'+(I.text||"")+"</span>",G=[];I.className&&G.push(I.className);I.disabled&&G.push("disabled");I.selected&&G.push("selected");!K[H+1]&&G.push("last");!K[H-1]&&G.push("first");var L=AJS("a").attr({href:K[H].href||"#","class":G.join(" ")}).html(J);K[H].tooltip&&L.attr("title",K[H].tooltip);if(I.disabled){L.attr("title",I.disabledText);L.disable();L.click(function(O){return AJS.stopEvent(O)})}else{K[H].click&&(function(P,O){O.click(function(Q){P.click(O);return AJS.stopEvent(Q)})})(K[H],L)}E.append(L)}return this.create(F,E,N)},create:function(G,J,F){F=F||{};AJS.Editor.Adapter.storeCurrentSelectionState();var H=D("#property-panel"),E;H.length&&this.destroy();H=AJS("div").addClass("aui-property-panel-parent").attr("id","property-panel").appendTo("body");E=AJS("div").addClass("aui-property-panel").append(J);H.append(E).css({top:0,left:-10000});var I=this;J.find(".last:last").css({margin:0});var L=C(H),K=B(H);this.current={anchor:G,panel:H,isAnchor:function(M){return I.isAnchor(M)},snapToElement:function(M){A(this,M)},shadow:L,tip:K,options:F,updating:true};A(this.current);E=this.current;AJS.$(document).bind("keydown.property-panel.escape",function(M){if(M.keyCode===27){AJS.Confluence.PropertyPanel.destroy()}});AJS.$(document).bind("click.property-panel",function(M){if(!AJS.$(M.target).closest("#property-panel").length){AJS.Confluence.PropertyPanel.destroy()}});AJS.trigger("created.property-panel",this.current);this.current.updating=false;return this.current},destroy:function(){if(!this.current){AJS.log("PropertyPanel.destroy: called with no current PropertyPanel, returning");return }if(this.current.updating){AJS.log("PropertyPanel.destroy: called while updating, returning");return }AJS.trigger("destroyed.property-panel",this.current);AJS.unbind("destroyed.property-panel");AJS.$(document).unbind(".property-panel");this.current.panel.remove();this.current.shadow.remove();this.current=null},isAnchor:function(E){return this.current&&D(this.current.anchor)[0]==D(E)[0]}}})(AJS.$);