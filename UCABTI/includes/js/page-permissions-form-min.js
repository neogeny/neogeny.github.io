AJS.PagePermissions.Controls=function(B){var D=AJS.$;var C={handleNonExistentEntityNames:function(G){if(!G||!G.length){return }var F=G.join(", ");var H=AJS.I18n.getText("page.perms.error.invalid.entity.names")+" "+F;D("#page-permissions-error-div").find("div").text(H).end().removeClass("hidden");B.refreshLayout()},isDuplicateEntityForType:function(F,H){var G=D("#page-permissions-table ."+H+"-permission-row .permission-entity-name").filter(function(){return D(this).text()==F.name});return G.length>0},resetValidationErrors:function(){D("#page-permissions-error-div").addClass("hidden");B.refreshLayout()}};var A=(function(){var F=D("#page-permissions-names-input");var I=D("#page-permissions-names-hidden");var H=F.val();var G="input-placeholder";F.keypress(function(J){if(J.keyCode==Event.KEY_RETURN){E();F.focus();return false}return true});F.quicksearch("/json/contentnamesearch.action?type=userinfo",null,{dropdownPostprocess:function(J){D("ol.last",J).remove();if(D("ol",J).length==0){J.append(AJS.renderTemplate("permissions-username-no-suggestion-template"))}},dropdownPlacement:function(K){var J=AJS("div");J.addClass("page-perms-name-dropdown-wrapper aui-dd-parent");J.append(K);F.after(J)},ajsDropDownOptions:{selectionHandler:function(L,K){if(K.hasClass("message")){return }var J=D.data(K.find("span")[0],"properties");var M=J.href.substr(J.href.lastIndexOf("/")+2);I.val(unescape(M.replace(/\+/g," ")));F.val("");E();this.hide();L.preventDefault()}}});F.focus(function(){if(F.hasClass(G)){F.removeClass(G).val("")}var L=F.next(".aui-dd-parent");if(!L.length){return }L.show();var J=F.offset().left;if(L.offset().left!=J){L.css("margin-left",0);var N=J-L.offset().left;L.css("margin-left",N+"px")}var M=F.offset().top+F.outerHeight();if(L.offset().top!=M){L.css("margin-top",0);var K=M-L.offset().top;L.css("margin-top",K+"px")}L.css({width:F.outerWidth()});L.hide()});F.blur(function(){if(F.val()==""){F.addClass(G).val(H)}});return{getValue:function(){var J=I.val();if(J){I.val("")}else{J=F.val();if(J==H){J=""}}return J},addPlaceholder:function(){F.addClass(G).val(H)},removeFromNameInput:function(M){if(!M){return }var L=F.val();if(!L){return }var J=L.split(",");for(var K=0;K<J.length;K++){J[K]=D.trim(J[K])}J=D.grep(J,function(N){return N!=""&&N!=M});if(J.length){F.val(J.join(", "))}else{if(document.activeElement==F[0]){F.val("")}else{this.addPlaceholder()}}}}})();var E=function(){C.resetValidationErrors();B.table.clearHighlight();var F=A.getValue();if(!F){return }B.addNames(F)};D("#page-permissions-choose-me").click(function(F){C.resetValidationErrors();B.addNames(D(this).find(".remote-user-name").text());return AJS.stopEvent(F)});D("#permissions-error-div-close").click(function(F){C.resetValidationErrors();return AJS.stopEvent(F)});D("#add-typed-names").click(E);return{validator:C,nameField:A,setVisible:function(F){AJS.setVisible("#page-permissions-editor-form",F);AJS.setVisible(".remove-permission-link",F);if(F){A.addPlaceholder()}},isShowing:function(){return !D("#page-permissions-editor-form").hasClass("hidden")},getPermissionType:function(){return !!D("#restrictViewRadio:checked").length?"view":"edit"}}};